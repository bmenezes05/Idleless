@{
    ViewBag.Title = "BTP";
}

<div id="containerIndex" class="mx-3 my-2 px-3 py-2">
    <div class="navbar fixed-top navbar-dark navbar-white navbar-expand margin-navbar shadow">
        <a class="navbar-brand" href="#"></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <ul class="nav" id="myTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link mx-4 active" id="agenda-tab" data-toggle="tab" href="#agenda" role="tab" aria-controls="agenda" aria-selected="true">Agenda</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link mx-4" id="dashboard-tab" data-toggle="tab" href="#dashboard" role="tab" aria-controls="dashboard" aria-selected="false">Dashboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link mx-4" id="previsao-tab" data-toggle="tab" href="#previsao" role="tab" aria-controls="previsao" aria-selected="false">Previsões</a>
                </li>
            </ul>
        </div>
    </div>

    <div id="agenda" class="tab-pane fade row show d-none active " role="tabpanel">
        <div class="col-md-9 col-sm-12 mb-4 p-0">
            <div class="col-12 mb-4">
                <h4>
                    Agenda
                </h4>
                <hr class="m-1" />
                <div class="mt-3 p-4 bg-white" style="height: 600px;">
                    <div class="row">
                        <div class="col-6 text-center">
                            <input class="form-check-input my-0 checkbox-custom" type="checkbox" v-model="checkNavio" id="checkNavio" @@change="filtrarAgendamentos">
                            <label class="form-check-label checkbox-label ml-2" for="checkNavio">
                                Navios
                            </label>
                        </div>
                        <div class="col-6 text-center">
                            <input class="form-check-input my-0 checkbox-custom" type="checkbox" v-model="checkAtividade" id="checkAtividade" @@change="filtrarAgendamentos">
                            <label class="form-check-label checkbox-label ml-2" for="checkAtividade">
                                Atividades
                            </label>
                        </div>
                    </div>
                    <div id="scheduler_here" class="dhx_cal_container" style='width:100%; height:100%'>
                        <div class="dhx_cal_navline">
                            <div class="dhx_cal_prev_button">&nbsp;</div>
                            <div class="dhx_cal_next_button">&nbsp;</div>
                            <div class="dhx_cal_today_button"></div>
                            <div class="dhx_cal_date"></div>
                        </div>
                        <div class="dhx_cal_header">
                        </div>
                        <div class="dhx_cal_data">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-12 mb-4 p-0">
            <div class="col-12 mb-4">
                <h4>
                    Pontos
                </h4>
                <hr class="m-1" />
                <div class="mt-3 px-2 pb-3 bg-white">
                    <div class="col-12 text-center p-3">
                        <h3>{{ pontuacao }}</h3>
                        <span class="numero-pontos-legenda">Número de pontos</span>
                       
                    </div>
                    @*<div v-if="carregando">
                               <div class="text-center">
                                   <i class="spinner text-secondary material-icons">data_usage</i>
                                   <div><b>Carregando</b></div>
                               </div>
                        </div>*@
                </div>
            </div>
            <div class="col-12 mb-4">
                <h4>
                    Próximas atividades
                </h4>
                <hr class="m-1" />
                <div class="mt-3 px-2 pb-3 bg-white">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Horário</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><a href="../Home/DetalheAtividade">Palestra sobre segurança do trabalho</a></td>
                                <td>18h - 19h</td>
                            </tr>
                            <tr>
                                <td><a href="../Home/DetalheAtividade">Psicólogo</a></td>
                                <td>20h - 21h</td>
                            </tr>
                            <tr>
                                <td><a href="../Home/DetalheAtividade">Dentista</a></td>
                                <td>23h - 00h</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="col-12 text-right">
                        <a href="../Home/InscreverAtividade">Inscrever-se</a>
                    </div>
                    @*<div v-if="carregando">
                               <div class="text-center">
                                   <i class="spinner text-secondary material-icons">data_usage</i>
                                   <div><b>Carregando</b></div>
                               </div>
                        </div>*@
                </div>
            </div>
        </div>
    </div>
    <div id="dashboard" class="tab-pane fade col-12 row d-none" role="tabpanel">
        <div class="col-md-12 p-2 row">
            <div class="col-8">
                <h4>
                    Atividades mais procuradas
                </h4>
                <hr class="m-1" />
                <div class="mt-3 p-3 bg-white">
                    <canvas id="myChart"></canvas>
                </div>
            </div>
            <div class="col-4">
                <h4>
                    Colaboradores mais produtivos
                </h4>
                <hr class="m-1" />
                <div class="mt-3 p-3 bg-white">
                    <canvas id="myChart1"></canvas>
                </div>
            </div>
        </div>
    </div>
    <div id="previsao" class="tab-pane fade row d-none" role="tabpanel">
        <div class="col-md-9 col-sm-12 mb-4 p-0">
            <div class="col-12 mb-4">
                <h4>
                    Previsão
                </h4>
                <hr class="m-1" />
                <div class="mt-3 p-0 bg-white">
                    <iframe class="col-12 p-0" height="600" src="https://embed.windy.com/embed2.html?lat=-30.259&lon=-40.034&zoom=5&level=surface&overlay=wind&menu=&message=&marker=&calendar=&pressure=&type=map&location=coordinates&detail=&detailLat=-30.259&detailLon=-40.034&metricWind=default&metricTemp=default&radarRange=-1" frameborder="0"></iframe>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-12 mb-4 p-0">
            <div class="col-12 mb-4">
                <h4>
                    Notícias
                </h4>
                <hr class="m-1" />
                <div class="mt-3 px-2 py-3 bg-white">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item"><a href="#">Nova greve dos caminhoneiros pode ocorrer esta semana</a></li>
                        <li class="list-group-item"><a href="#">Frente fria pode estar se aproximando</a></li>
                        <li class="list-group-item"><a href="#">Porto receberá aumento de frotas em 2020</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    var app = new Vue({
        el: '#containerIndex',
        data: {
            checkAtividade: false,
            checkNavio: false,
            pontuacao: 0,
            agendamentos: []
        },
        methods: {
            init: function (dados) {
                scheduler.clearAll();
                scheduler.config.xml_date = "%Y-%m-%d %H:%i";
                scheduler.init('scheduler_here', new Date(), "week");
                scheduler.config.readonly_form = true;
                scheduler.attachEvent("onBeforeDrag", function () { return false; })
                scheduler.attachEvent("onClick", function () { return false; })
                scheduler.config.details_on_dblclick = true;
                scheduler.config.dblclick_create = false;
                //scheduler.parse(self.agendamentos, "json");
                scheduler.load("../../Json/events.json", "json");
                //scheduler.load(dados, "json");
            },
            filtrarAgendamentos: function () {
                var self = this;
                $.ajax({
                    url: "../Home/getAgendamentos",
                    data: { navio: self.checkNavio, atividade: self.checkAtividade }
                }).success(function (result) {
                    scheduler.config.xml_date = "%Y-%m-%d %H:%i";
                    scheduler.templates.event_class = function (start, end, event) {
                        var css = "";
                        if (event.tipo_modalidade == "Navio") 
                            css += "event_navio";

                        if (event.tipo_modalidade == "Lazer") 
                            css += "event_modalidade";
                    
                        return css;
                    };

                    scheduler.parse(JSON.parse(result.data).data, "json");
                    scheduler.updateView();
                });
            },
            initChart: function () {
                var ctx = document.getElementById('myChart').getContext('2d');
                var ctx1= document.getElementById('myChart1').getContext('2d');

                var chart = new Chart(ctx, {
                    // The type of chart we want to create
                    type: 'bar',

                    // The data for our dataset
                    data: {
                        labels: ['Cursos bem estar', 'Massagem', 'Psicólogo', 'Academia', 'Jogos', 'Dentista'],
                        datasets: [{
                            backgroundColor: ['rgba(255, 99, 132, 0.4)',
                                'rgba(54, 162, 235, 0.4)',
                                'rgba(255, 206, 86, 0.4)',
                                'rgba(75, 192, 192, 0.4)',
                                'rgba(153, 102, 255, 0.4)',
                                'rgba(255, 159, 64, 0.4)'],
                            borderColor: ['rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)'],
                            borderWidth: 1,
                            data: [3, 10, 5, 2, 20, 30]
                        }]
                    },
                    // Configuration options go here
                    options: {
                        legend: {
                            display: false
                        }
                    }
                });

                var chart1 = new Chart(ctx1, {
                    // The type of chart we want to create
                    type: 'pie',

                    // The data for our dataset
                    data: {
                        labels: ['João Silva Batista', 'Julia Maria Jesus', 'Marcos Paulo', 'Alessandra Marques', 'Rafael Gericó', 'William Veiga'],
                        datasets: [{
                            backgroundColor: ['rgba(255, 99, 132, 0.4)',
                                'rgba(54, 162, 235, 0.4)',
                                'rgba(255, 206, 86, 0.4)',
                                'rgba(75, 192, 192, 0.4)',
                                'rgba(153, 102, 255, 0.4)',
                                'rgba(255, 159, 64, 0.4)'],
                            borderColor: ['rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)'],
                            borderWidth: 1,
                            data: [3, 10, 5, 2, 20, 30]
                        }]
                    },
                    // Configuration options go here
                    options: {
                        legend: {
                            display: false
                        }
                    }
                });
            },
            getScore: function () {
                var self = this;
                $.ajax({
                    url: "../Home/getScore",
                    data: { pessoaId: 1 }
                }).success(function (result) {
                    self.pontuacao = result.data;
                });
            },
        },
        mounted: function () {
            this.init();
            this.initChart();
            this.getScore();
        }
    })
</script>
